from pwn import *
from requests import *
from hashlib import md5
from os import urandom

alpha="abcdefghijklmnopqrstuvwxyz0123456789_-"
s=Session()

def crack(res):
    global alpha
    args=""
    for i in res:
        args+=f"{alpha.index(i)} {alpha.index(i)} 0 37 "
    p=process(f"./php_mt_seed-4.0/php_mt_seed {args[:-1]}",shell=True)
    p.recvuntil(b"seed = ")
    p.close()
    return bytes.fromhex(p.recvline().decode().split(" = ")[0][2:]).decode()

def get_username():
    global index
    global alpha
    test=''.join([random.choice(alpha) for i in range(8)]).encode()
    while md5(test).hexdigest()[0]!=str(index):
        test=''.join([random.choice(alpha) for i in range(8)]).encode()
    return test

flag = "ENO{"
index = 1

while flag[-1]!='}':
    username=get_username()
    s.post("http://52.59.124.14:5008",data={"username":username,"password":""})
    try:
        flag+=crack(s.cookies.get_dict()['PHPSESSID'][:227])
        s.cookies.clear()
        index+=1
        print("\nFLAG: " + flag)
    except KeyError:
        continue